# 函数调用过程

函数调用的过程就是压栈和出栈的过程。

## 1. 按照约定传递参数

约定参数传递主要涉及的方面有：

- 参数传递方向。从左往右传递参数或者从右往左传递参数。
- 参数传递方法。常见有栈传参和寄存器传参。

- 释放参数空间。如果是不定参数时，只能由调用方释放参数空间。
- 函数返回值存放位置。

### 常见的调用约定

|       -        | `__cdecl` | `__stdcall` |                   `__fastcall`                   |
| :------------: | :-------: | :---------: | :----------------------------------------------: |
|  参数传递方向  | 从右往左  |  从右往左   |                     从右往左                     |
|  参数传递方法  |  栈空间   |   栈空间    | 做数前两个参数使用寄存器传递，其余参数使用栈传递 |
|  释放参数空间  |  调用方   |   被调方    |                      被调方                      |
| 返回值存放位置 |  寄存器   |   寄存器    |                      寄存器                      |

> - `__cdecl`、  `__stdcall`  支持跨平台的调用约定。
> - `__fastcall`为微软专有。
> - C默认调用约定为`__cdecl` 。

## 2. 保存返回地址

在栈空间保存下一条指令的地址到栈顶作为返回地址。